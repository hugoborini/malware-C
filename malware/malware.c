#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <dirent.h>
#include <sys/stat.h>

char *appendFolder(char *prefix, char *src){
    int buffer = strlen(prefix) + strlen(src) + 1;
    char *final=malloc(sizeof(char) * buffer + 1);
    strcpy(final, prefix);
    strcat(final, "/");
    strcat(final, src);

    

    return final;
}

char *getPath(char *file){
    char *absPath;
    absPath=malloc(sizeof(char) * 1024);

    if (realpath(file, absPath) != NULL) {
        return (absPath);
    } else {
        return "error\n";
    }
    return "error\n";
}


int isFolder(char *path){
    DIR* directory = opendir(path);
    if (directory == NULL) {
        return 0;
    } else{
        return 1;
    }

    
}

int cryptFolder(char *folder){
    DIR* directory = opendir(folder);

    int final = 0;
    if (directory == NULL) {
        printf("error");
        return 42;
    }
    struct dirent* entry;
    struct stat info;
    while ((entry = readdir(directory)) != NULL) {
        if(strcmp(entry->d_name, "..") != 0 && strcmp(entry->d_name, ".") != 0 ){
            if(isFolder(getPath(appendFolder(folder,entry->d_name))) == 1){
                cryptFolder(getPath(appendFolder(folder,entry->d_name)));
            } else{
                printf("%s \n", getPath(appendFolder(folder,entry->d_name)));
            }

        }
    }



    closedir(directory);
    return 0;
}


int main(void){
   //char *test= getPath("/home/ssh-hugo.borini/test-c/malware-tp/test/1");
   //printf("%s", test);
    cryptFolder("../test");


    return 0;
}